---
layout: post
title: "[Python]전처리-주소 처리"
date: 2023-08-12 16:50 +0900
categories: [Python, 전처리]
tags: []
---

## Intro: 

프로젝트 도중 주소를 크롤링해와 분해해 데이터베이스에 넣어야 하는 상황이 있었는데, 크롤링하는 웹사이트에 생각보다 주소가 다양하게 등록되있어 많은 시간이 소요되었다. 기왕 애 먹은거 정리해보자 한다


## 주소 패턴 파악

### 공백 기준 패턴 파악
어떻게 파악해볼지 고민하다 우선 **공백 기준**으로 분류를 해보았다

1. **4개의 공백**: 서울특별시 은평구 역촌동 36-37 801호
2. **5개의 공백**: 서울특별시 서초구 잠원동 32-22 6층601호 (잠원동,보미리전빌)
3. **6개의 공백**: 서울특별시 서초구 잠원동 58-24 323동 2층210호 (잠원동,신반포아파트)
4. **7개의 공백**: 서울특별시 관악구 남현동 1135 우림루미아트아파트 제103동 제1층 제101호
5. **8개의 공백**: 서울특별시 강남구 압구정동 481외 2필지 현대아파트 제91동 제6층 제604호
6. **9개의 공백**: 서울특별시 양천구 목동 961외 1필지 목동현대 하이페리온2 제203동 제5층 제502호
7. **10개의 공백**: 서울특별시 종로구 평창동 108외 1필지 평창동 롯데캐슬 로잔 제101동 제8층 제801호

나쁘지 않지만, 도로명 주소 부터 분류해야할 것 같다
## 지번 주소

```python
# 주소 분리 함수
def split_address(address):
    # 도시 정보 추출
    city_match = re.search(r'(서울특별시|부산광역시|대구광역시|인천광역시|광주광역시|대전광역시|울산광역시|세종특별자치시|경기도|강원도|충청북도|충청남도|전라북도|전라남도|경상북도|경상남도|제주특별자치도)', address)
    city = city_match.group(1) if city_match else None

    # 도시 이후의 내용 분석
    remaining_address = address[city_match.end():].strip() if city else address

    # 구/군 정보 추출
    district_match = re.search(r'(\w+시|\w+군|\w+구)', remaining_address)
    district = district_match.group(1) if district_match else None
    remaining_address = remaining_address[district_match.end():].strip() if district else remaining_address

    # 동/읍/면 정보 추출
    neighborhood_match = re.search(r'(\w+동|\w+읍|\w+면)', remaining_address)
    neighborhood = neighborhood_match.group(1) if neighborhood_match else None
    remaining_address = remaining_address[neighborhood_match.end():].strip() if neighborhood else remaining_address

    # 주소 번호 추출
    number_match = re.search(r'(\d+-?\d*)', remaining_address)
    address_number = number_match.group(1) if number_match else None
    remaining_address = remaining_address[number_match.end():].strip() if address_number else remaining_address

    # 아파트 동 정보 추출
    apartment_block_match = re.search(r'제?(\d+동)', remaining_address)
    apartment_block = apartment_block_match.group(1) if apartment_block_match else None

    # 층과 호 정보 추출
    floor_match = re.search(r'제?(\d+)층', remaining_address)
    room_match = re.search(r'제?(\d+)호', remaining_address)
    floor = floor_match.group(1) if floor_match else None
    room = room_match.group(1) if room_match else None

    # 괄호 안의 내용 추출 및 아파트 이름 추출
    inside_brackets_match = re.search(r'\((.*)\)', address)
    inside_brackets = inside_brackets_match.group(1) if inside_brackets_match else None
    if inside_brackets:
        apartment_name = inside_brackets.split(',')[-1].strip()
    else:
        # 괄호 안의 내용이 없으면 주소에서 아파트 이름 추출
        apartment_name_match = re.search(r'(\w+아파트)', remaining_address)
        apartment_name = apartment_name_match.group(1) if apartment_name_match else None

    return city, district, neighborhood, address_number, apartment_block, floor, room, apartment_name

```

> 도로명 주소의 경우 무조건 문제가 있고, 지번 주소의 경우에도 아파트 동 정보가 한글이면 가져오지 못했다

### 테스트

테스트시 사용한 주소와 나와야 하는 결과는 다음과 같다:

1. 주소: "서울특별시 은평구 응암동 197-78 신동아아파트 제2동 제2층 제202호"

시/도: 서울특별시
구/군: 은평구
동/읍/면: 응암동
번지: 197-78
아파트 동: 2동
층: 2
호: 202호
아파트 이름: 신동아아파트
도로명 주소 여부: None


2. 주소: "서울특별시 강남구 언주로 427, 17층1708호 (역삼동,디오빌역삼)"

시/도: 서울특별시
구/군: 강남구
동/읍/면: 역삼동
아파트 이름: 디오빌역삼
층: 17
호: 1708호
도로명 주소 여부: yes


3. 주소: "서울특별시 용산구 한강로3가 91 104동 4층404호 (한강로3가,한강로우림필유아파트)"

시/도: 서울특별시
구/군: 용산구
동/읍/면: 한강로3가
번지: 91
아파트 동: 104동
층: 4
호: 404호
아파트 이름: 한강로우림필유아파트
도로명 주소 여부: None


4. 주소: "서울특별시 강남구 압구정동 481외 2필지 현대아파트 제91동 제6층 제604호"

시/도: 서울특별시
구/군: 강남구
동/읍/면: 압구정동
번지: 481
아파트 동: 91동
층: 6층
호: 604호
아파트 이름: 현대아파트
도로명 주소 여부: None