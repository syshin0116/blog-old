---
layout: post
title: "[SeSAC]파이썬 데이터 처리 프로그래밍-4일차"
date: 2023-08-03 09:00:33 +0900
categories: [SeSAC,파이썬 데이터 처리 프로그래밍]
tags: []
---

## Selenium

### 네이버 주식 크롤링 

```python
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
import requests
import time
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.keys import Keys

service = Service()
d = webdriver.Chrome(service=service)

try:
    url = 'https://finance.naver.com/'
    d.get(url)
    trs = WebDriverWait(d, 10).until(EC.presence_of_all_elements_located((By.CSS_SELECTOR, '#_topItems1 > tr')))
    for tr in trs:
        updown = tr.get_attribute("class")
        if updown == "up":
            sign = "+"
        elif updown == "down":
            sign = "-"
        else: sign = ""
        item = tr.find_element(By.CSS_SELECTOR, "th > a").text.strip()
        tds = tr.find_elements(By.CSS_SELECTOR, "td")
        price = tds[0].text.strip()
        num = tds[1].text.strip().replace("\n", "")
        rate = tds[2].text.strip()
        print(f"{item}, {price}, {num}, {rate}")
except Exception as e:
    print(e)
finally:
    d.close()
    d.quit()
```

### 인스타그램

#### Selenium 정보 저장
1. 빈 파일 생성
2. 로그인정보를 저장하기 위해 추가된 코드

```python
# 크롬에 정보 저장
options = webdriver.ChromeOptions()
options.add_argument("--user-data-dir={디렉토리 경로}")
service = Service()
d = webdriver.Chrome(service=service, options=options)
```

2. 코드 중간에 `input()`을 넣어 두고 실행 (코드 일시정지 용도) 
3. 열린 크롬 창에서 인스타 로그인
4. `input()`에 입력 하여 코드 종료

### 인스타 \#python 크롤링

```python
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
import requests
import time
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.action_chains import ActionChains

# 크롬에 정보 저장
options = webdriver.ChromeOptions()
options.add_argument("--user-data-dir=/Users/syshin/Desktop/Syshin/SeSAC/파이썬 데이터 처리 프로그래밍/4일차-/MyChrome")
service = Service()
d = webdriver.Chrome(service=service, options=options)


try:
    url = 'https://www.instagram.com/'
    d.get(url)

    # 검색 버튼
    buttons = WebDriverWait(d, 10).until(EC.presence_of_all_elements_located((By.CSS_SELECTOR, ".xvy4d1p")))
    # buttons = d.find_elements(By.CSS_SELECTOR, ".xvy4d1p")
    search_button = buttons[2]
    
    # 검색 버튼 클릭
    ac = ActionChains(d)
    ac.move_to_element(search_button).click().pause(1)
    ac.perform()
    
    elem = WebDriverWait(d, 10).until(EC.presence_of_element_located((By.CSS_SELECTOR, ".x7xwk5j")))
    ac.reset_actions()
    # ac.move_to_element(elem).click().send_keys("#파이썬")
    ac.send_keys_to_element(elem, "#파이썬")
    ac.pause(1)
    ac.move_by_offset(0,100)
    ac.click()
    ac.perform()
    
    posts = WebDriverWait(d, 10).until(EC.presence_of_all_elements_located((By.CSS_SELECTOR, "._aabd")))
    for post in posts:
        ac.reset_actions()
        ac.click(post)
        # ac.pause(1)
        ac.perform()
        content = WebDriverWait(d, 10).until(EC.presence_of_element_located((By.CSS_SELECTOR, "._a9zs > ._aade")))
        print(content.text)
        ac.reset_actions()
        ac.send_keys(Keys.ESCAPE)
        ac.perform()

    
except Exception as e:
    print(e)
finally:
    time.sleep(3)
    d.close()
    d.quit()
    
```

### 인스타 크롤링 \#고양이 검색, 엑셀에 저장 실습

```python
from selenium import webdriver
from openpyxl import Workbook
from selenium.webdriver import ChromeOptions
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.action_chains import ActionChains

wb = Workbook()
ws = wb.active

options = ChromeOptions()

# options.add_argument("--headless") # 브라우저 안뜬 상태로 진행
# options.add_argument("--window-size=1920,1080)") # 브라우저 사이즈 조절
options.add_argument("--user-data-dir=/Users/syshin/Desktop/Syshin/SeSAC/파이썬 데이터 처리 프로그래밍/4일차-/MyChrome")
service = Service()
d = webdriver.Chrome(service=service, options=options)
url = "https://www.instagram.com"

try:
    d.get(url)
    buttons = WebDriverWait(d, 10).until(EC.presence_of_all_elements_located((By.CSS_SELECTOR, '.xvy4d1p')))
    search_button = buttons[2]
    
    ac = ActionChains(d)
    ac.move_to_element(search_button).click().pause(1).perform()
    
    elem = WebDriverWait(d, 10).until(EC.presence_of_element_located((By.CSS_SELECTOR, "input.x7xwk5j")))
    
    ac.reset_actions()
    ac.send_keys_to_element(elem, "#고양이").pause(2)
    ac.send_keys(Keys.TAB, Keys.TAB, Keys.ENTER).perform()
    
    ac = ActionChains(d)
    posts = WebDriverWait(d, 10).until(EC.presence_of_all_elements_located((By.CSS_SELECTOR, "div._al3l > a._a6hd")))

    for post in posts:
        ac.reset_actions()
        ac.click(post).perform()
        content = WebDriverWait(d, 10).until(EC.presence_of_element_located((By.CSS_SELECTOR, "div._a9zs> h1._aade"))).text
        ac.reset_actions()
        ws.append([content])
        ac.send_keys(Keys.ESCAPE).perform()
except Exception as e:
    print(e)
    
finally:
    time.sleep(3)
    d.close()
    d.quit()
    wb.save("instagram.xlsx")
```


## 미니프로젝트

> Except 위치 나타내기
> ```python
> import traceback
try:
except:
	traceback.print_exc()
```