---
layout: post
title: ë”¥ëŸ¬ë‹ ì˜ìƒì²˜ë¦¬2
date: 2023-11-20 10:13 +0900
categories:
  - SeSAC
  - Computer-Vision
tags: 
math: true
---
### General Object Detection Framework

1. **Region Proposal**
    - ì´ë¯¸ì§€ ì•ˆì˜ ì ì¬ì  ê°ì²´ ìœ„ì¹˜ ì‹ë³„
    - ë‹¤ì–‘í•œ í¬ê¸°ì™€ ë¹„ìœ¨ë¡œ ì´ë¯¸ì§€ ë¶„í• , ê° ì˜ì—­ í‰ê°€
    - ì´ ë‹¨ê³„ì—ì„œ R-CNNê³¼ ê°™ì€ ë°©ë²• í™œìš©

2. **Feature Extraction and Network Predictions**
    - ì˜ì—­ ì œì•ˆ í›„, ê° ì˜ì—­ì—ì„œ íŠ¹ì§• ì¶”ì¶œ. ì£¼ë¡œ CNN ì‚¬ìš©
    - ì¶”ì¶œëœ íŠ¹ì§•ì„ ë°”íƒ•ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ê°€ ê°ì²´ í´ë˜ìŠ¤ì™€ ìœ„ì¹˜ ì˜ˆì¸¡
    - Faster R-CNN, YOLO, SSD ë“±ì´ ì´ ë‹¨ê³„ì—ì„œ ì‚¬ìš©

3. **Non-Maximum Suppression (NMS)**
    - ì¤‘ë³µ ì˜ì—­ ì œì•ˆ ì¤‘ ìµœì  ì˜ˆì¸¡ ì„ íƒ
    - ìµœëŒ€ ì ìˆ˜ ì˜ˆì¸¡ ìœ ì§€, ì¤‘ë³µ ì˜ì—­ ì œê±°
    - ì •í™•ë„ í–¥ìƒê³¼ ì¤‘ë³µ ê°ì†Œì— ì¤‘ìš”

4. **Evaluation Metrics**
    - ê°ì²´ íƒì§€ ëª¨ë¸ ì„±ëŠ¥ í‰ê°€
    - ì •ë°€ë„, ì¬í˜„ìœ¨, F1 ìŠ¤ì½”ì–´ ë“±ì„ ì£¼ìš” ì§€í‘œë¡œ ì‚¬ìš©
    - í´ë˜ìŠ¤ë³„ ì„±ëŠ¥ì€ Average Precision(AP)ìœ¼ë¡œ í‰ê°€

> Two-phase system: íŠ¹ì • ì¥ì†Œì— ë­ê°€ ìˆì„ê²ƒ ê°™ë‹¤ ë¼ê³  ë¨¼ì € ìƒê° í•œ í›„ì—, Detect í•œë‹¤. ì¦‰, Region proposal ì´í›„ Detectiong
### Selective Search
- ì´ë¯¸ì§€ ë‚´ ê°ì²´ í›„ë³´ ì˜ì—­ ì‹ë³„ ë°©ë²•
- ì˜ì—­ ì œì•ˆì—ì„œ ì¤‘ìš”í•œ ì—­í• , ê°ì²´ íƒì§€ ì„±ê³µë¥ ì— ì˜í–¥

### Object-detector Evaluation Metrics
- **Frames per Second (FPS)**
    - íƒì§€ ì†ë„ ì¸¡ì •
- **Mean Average Precision (mAP)**
    - ë‹¤ì–‘í•œ ì„ê³„ê°’ì—ì„œ í‰ê·  ì •ë°€ë„ ì¸¡ì •
- **Intersection Over Union (IOU)**
    - ì˜ˆì¸¡ ë° ì‹¤ì œ ê²½ê³„ ìƒìì˜ ê²¹ì¹¨ ì •ë„ ì¸¡ì •

### R-CNNì˜ ë‹¨ì 
- ê°ì²´ íƒì§€ ì†ë„ ëŠë¦¼
- í›ˆë ¨ ê³¼ì • ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ë‰¨, SVMê³¼ CNN ë”°ë¡œ í›ˆë ¨
- í›ˆë ¨ì— ë§ì€ ì‹œê°„ê³¼ ê³µê°„ í•„ìš”

### Fast R-CNN
- Feature extractor ì‚¬ìš©í•˜ì—¬ íŠ¹ì§• ë¨¼ì € ì¶”ì¶œ
- Selective Search ë‹¨ì ìœ¼ë¡œ ì†ë„ ë¬¸ì œ ì§€ì†
- RoI pooling ë° fully connected layers í†µí•´ ê²°ê³¼ ë„ì¶œ

> selective searchë¥¼ ë¨¼ì € í•œ í›„ì— RoI êµ¬í•¨. ë”°ë¼ì„œ selective search ì˜ ë‹¨ì ì¸ ëŠë¦¼ì„ ê·¸ëŒ€ë¡œ ë°›ìŒ
### Single-shot Detector (SSD)
- Selective Search ì‚¬ìš©í•˜ì§€ ì•Šê³ , ê°ì²´ íƒì§€ ì†ë„ í–¥ìƒì— ì´ˆì 


## ì½”ë“œ:

###  selective searchë¥¼ ì´ìš©í•˜ì—¬ Object Detectionì„ ìœ„í•œ Region Proposal ì˜ì—­ì„ ë„ì¶œ

#### selectivesearchë¥¼ ì„¤ì¹˜í•˜ê³  ì´ë¯¸ì§€ë¥¼ ë¡œë“œ


```python
!pip install selectivesearch
```

    Collecting selectivesearch
      Downloading selectivesearch-0.4.tar.gz (3.8 kB)
      Preparing metadata (setup.py) ... [?25l[?25hdone
    Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from selectivesearch) (1.23.5)
    Requirement already satisfied: scikit-image in /usr/local/lib/python3.10/dist-packages (from selectivesearch) (0.19.3)
    Requirement already satisfied: scipy>=1.4.1 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (1.11.3)
    Requirement already satisfied: networkx>=2.2 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (3.2.1)
    Requirement already satisfied: pillow!=7.1.0,!=7.1.1,!=8.3.0,>=6.1.0 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (9.4.0)
    Requirement already satisfied: imageio>=2.4.1 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (2.31.6)
    Requirement already satisfied: tifffile>=2019.7.26 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (2023.9.26)
    Requirement already satisfied: PyWavelets>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (1.4.1)
    Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.10/dist-packages (from scikit-image->selectivesearch) (23.2)
    Building wheels for collected packages: selectivesearch
      Building wheel for selectivesearch (setup.py) ... [?25l[?25hdone
      Created wheel for selectivesearch: filename=selectivesearch-0.4-py3-none-any.whl size=4336 sha256=e6f172eb5b85bc058e17be8ebac6be3a86cf3dae8e9fe003c55568503d951cf9
      Stored in directory: /root/.cache/pip/wheels/0e/49/95/01447a4e0f48a135ac91fbdb1dd2a1c0523e40e29957b383a3
    Successfully built selectivesearch
    Installing collected packages: selectivesearch
    Successfully installed selectivesearch-0.4



```python
!mkdir /content/data
!wget -O /content/data/audrey01.jpg https://raw.githubusercontent.com/chulminkw/DLCV/master/data/image/audrey01.jpg
```

    --2023-11-19 20:07:49--  https://raw.githubusercontent.com/chulminkw/DLCV/master/data/image/audrey01.jpg
    Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
    Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 30102 (29K) [image/jpeg]
    Saving to: â€˜/content/data/audrey01.jpgâ€™
    
    /content/data/audre 100%[===================>]  29.40K  --.-KB/s    in 0.003s  
    
    2023-11-19 20:07:50 (8.75 MB/s) - â€˜/content/data/audrey01.jpgâ€™ saved [30102/30102]
    



```python
import selectivesearch
import cv2
import matplotlib.pyplot as plt
import os
%matplotlib inline

### ì˜¤ë“œë¦¬í—µë²ˆ ì´ë¯¸ì§€ë¥¼ cv2ë¡œ ë¡œë“œí•˜ê³  matplotlibìœ¼ë¡œ ì‹œê°í™”
img = cv2.imread('./data/audrey01.jpg')
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
print('img shape:', img.shape)

plt.figure(figsize=(8, 8))
plt.imshow(img_rgb)
plt.show()
```

    img shape: (450, 375, 3)



    
![](https://i.imgur.com/6zLxluN.png)




```python
import selectivesearch

#selectivesearch.selective_search()ëŠ” ì´ë¯¸ì§€ì˜ Region Proposalì •ë³´ë¥¼ ë°˜í™˜
_, regions = selectivesearch.selective_search(img_rgb, scale=100, min_size=2000)

print(type(regions), len(regions))
```

    <class 'list'> 41


#### ë°˜í™˜ëœ Region Proposal(í›„ë³´ ì˜ì—­)ì— ëŒ€í•œ ì •ë³´ ë³´ê¸°.
ë°˜í™˜ëœ regions ë³€ìˆ˜ëŠ” ë¦¬ìŠ¤íŠ¸ íƒ€ì…ìœ¼ë¡œ ì„¸ë¶€ ì›ì†Œë¡œ ë”•ì…”ë„ˆë¦¬ë¥¼ ê°€ì§€ê³  ìˆìŒ.
ê°œë³„ ë”•ì…”ë„ˆë¦¬ë‚´ KEYê°’ë³„ ì˜ë¯¸
* rect í‚¤ê°’ì€ x,y ì‹œì‘ ì¢Œí‘œì™€ ë„ˆë¹„, ë†’ì´ ê°’ì„ ê°€ì§€ë©° ì´ ê°’ì´ Detected Object í›„ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” Bounding boxì„.
* sizeëŠ” segmentë¡œ selectëœ Objectì˜ í¬ê¸°
* labelsëŠ” í•´ë‹¹ rectë¡œ ì§€ì •ëœ Bounding Boxë‚´ì— ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë“¤ì˜ ê³ ìœ  ID
* ì•„ë˜ë¡œ ë‚´ë ¤ê°ˆ ìˆ˜ë¡ ë„ˆë¹„ì™€ ë†’ì´ ê°’ì´ í° Bounding boxì´ë©° í•˜ë‚˜ì˜ Bounding boxì— ì—¬ëŸ¬ê°œì˜ ì˜¤ë¸Œì íŠ¸ê°€ ìˆì„ í™•ë¥ ì´ ì»¤ì§.


```python
regions
```




    [{'rect': (0, 0, 107, 167), 'size': 11166, 'labels': [0.0]},
     {'rect': (15, 0, 129, 110), 'size': 8771, 'labels': [1.0]},
     {'rect': (121, 0, 253, 133), 'size': 17442, 'labels': [2.0]},
     {'rect': (134, 17, 73, 62), 'size': 2713, 'labels': [3.0]},
     {'rect': (166, 23, 87, 176), 'size': 8639, 'labels': [4.0]},
     {'rect': (136, 53, 88, 121), 'size': 4617, 'labels': [5.0]},
     {'rect': (232, 79, 117, 147), 'size': 7701, 'labels': [6.0]},
     {'rect': (50, 91, 133, 123), 'size': 7042, 'labels': [7.0]},
     {'rect': (305, 97, 69, 283), 'size': 11373, 'labels': [8.0]},
     {'rect': (0, 161, 70, 46), 'size': 2363, 'labels': [9.0]},
     {'rect': (72, 171, 252, 222), 'size': 34467, 'labels': [10.0]},
     {'rect': (0, 181, 118, 85), 'size': 5270, 'labels': [11.0]},
     {'rect': (106, 210, 89, 101), 'size': 2868, 'labels': [12.0]},
     {'rect': (302, 228, 66, 96), 'size': 2531, 'labels': [13.0]},
     {'rect': (0, 253, 92, 134), 'size': 7207, 'labels': [14.0]},
     {'rect': (153, 270, 173, 179), 'size': 10360, 'labels': [15.0]},
     {'rect': (0, 305, 47, 139), 'size': 4994, 'labels': [16.0]},
     {'rect': (104, 312, 80, 71), 'size': 3595, 'labels': [17.0]},
     {'rect': (84, 360, 91, 67), 'size': 2762, 'labels': [18.0]},
     {'rect': (0, 362, 171, 87), 'size': 7705, 'labels': [19.0]},
     {'rect': (297, 364, 77, 85), 'size': 5164, 'labels': [20.0]},
     {'rect': (0, 91, 183, 175), 'size': 12312, 'labels': [7.0, 11.0]},
     {'rect': (136, 23, 117, 176), 'size': 13256, 'labels': [4.0, 5.0]},
     {'rect': (72, 171, 254, 278), 'size': 44827, 'labels': [10.0, 15.0]},
     {'rect': (134, 17, 119, 182), 'size': 15969, 'labels': [4.0, 5.0, 3.0]},
     {'rect': (302, 97, 72, 283), 'size': 13904, 'labels': [8.0, 13.0]},
     {'rect': (121, 0, 253, 226), 'size': 25143, 'labels': [2.0, 6.0]},
     {'rect': (0, 91, 183, 175), 'size': 14675, 'labels': [7.0, 11.0, 9.0]},
     {'rect': (0, 0, 144, 167), 'size': 19937, 'labels': [0.0, 1.0]},
     {'rect': (0, 0, 253, 199),
      'size': 35906,
      'labels': [0.0, 1.0, 4.0, 5.0, 3.0]},
     {'rect': (0, 253, 92, 191), 'size': 12201, 'labels': [14.0, 16.0]},
     {'rect': (0, 91, 183, 353),
      'size': 26876,
      'labels': [14.0, 16.0, 7.0, 11.0, 9.0]},
     {'rect': (0, 171, 326, 278), 'size': 52532, 'labels': [10.0, 15.0, 19.0]},
     {'rect': (0, 97, 374, 352),
      'size': 66436,
      'labels': [10.0, 15.0, 19.0, 8.0, 13.0]},
     {'rect': (84, 312, 100, 115), 'size': 6357, 'labels': [17.0, 18.0]},
     {'rect': (0, 91, 184, 353),
      'size': 33233,
      'labels': [17.0, 18.0, 14.0, 16.0, 7.0, 11.0, 9.0]},
     {'rect': (0, 91, 195, 353),
      'size': 36101,
      'labels': [17.0, 18.0, 14.0, 16.0, 7.0, 11.0, 9.0, 12.0]},
     {'rect': (0, 0, 374, 444),
      'size': 61244,
      'labels': [17.0, 18.0, 14.0, 16.0, 7.0, 11.0, 9.0, 12.0, 2.0, 6.0]},
     {'rect': (0, 0, 374, 449),
      'size': 127680,
      'labels': [17.0,
       18.0,
       14.0,
       16.0,
       7.0,
       11.0,
       9.0,
       12.0,
       2.0,
       6.0,
       10.0,
       15.0,
       19.0,
       8.0,
       13.0]},
     {'rect': (0, 0, 374, 449),
      'size': 132844,
      'labels': [17.0,
       18.0,
       14.0,
       16.0,
       7.0,
       11.0,
       9.0,
       12.0,
       2.0,
       6.0,
       10.0,
       15.0,
       19.0,
       8.0,
       13.0,
       20.0]},
     {'rect': (0, 0, 374, 449),
      'size': 168750,
      'labels': [17.0,
       18.0,
       14.0,
       16.0,
       7.0,
       11.0,
       9.0,
       12.0,
       2.0,
       6.0,
       10.0,
       15.0,
       19.0,
       8.0,
       13.0,
       20.0,
       0.0,
       1.0,
       4.0,
       5.0,
       3.0]}]




```python
# rectì •ë³´ë§Œ ì¶œë ¥í•´ì„œ ë³´ê¸°
cand_rects = [cand['rect'] for cand in regions]
print(cand_rects)
```

    [(0, 0, 107, 167), (15, 0, 129, 110), (121, 0, 253, 133), (134, 17, 73, 62), (166, 23, 87, 176), (136, 53, 88, 121), (232, 79, 117, 147), (50, 91, 133, 123), (305, 97, 69, 283), (0, 161, 70, 46), (72, 171, 252, 222), (0, 181, 118, 85), (106, 210, 89, 101), (302, 228, 66, 96), (0, 253, 92, 134), (153, 270, 173, 179), (0, 305, 47, 139), (104, 312, 80, 71), (84, 360, 91, 67), (0, 362, 171, 87), (297, 364, 77, 85), (0, 91, 183, 175), (136, 23, 117, 176), (72, 171, 254, 278), (134, 17, 119, 182), (302, 97, 72, 283), (121, 0, 253, 226), (0, 91, 183, 175), (0, 0, 144, 167), (0, 0, 253, 199), (0, 253, 92, 191), (0, 91, 183, 353), (0, 171, 326, 278), (0, 97, 374, 352), (84, 312, 100, 115), (0, 91, 184, 353), (0, 91, 195, 353), (0, 0, 374, 444), (0, 0, 374, 449), (0, 0, 374, 449), (0, 0, 374, 449)]


**bounding boxë¥¼ ì‹œê°í™” í•˜ê¸°**


```python
# opencvì˜ rectangle()ì„ ì´ìš©í•˜ì—¬ ì‹œê°í™”
# rectangle()ì€ ì´ë¯¸ì§€ì™€ ì¢Œìƒë‹¨ ì¢Œí‘œ, ìš°í•˜ë‹¨ ì¢Œí‘œ, boxì»¬ëŸ¬ìƒ‰, ë‘ê»˜ë“±ì„ ì¸ìë¡œ ì…ë ¥í•˜ë©´ ì›ë³¸ ì´ë¯¸ì§€ì— boxë¥¼ ê·¸ë ¤ì¤Œ.

green_rgb = (125, 255, 51)
img_rgb_copy = img_rgb.copy()
for rect in cand_rects:

    left = rect[0]
    top = rect[1]
    # rect[2], rect[3]ì€ ë„ˆë¹„ì™€ ë†’ì´ì´ë¯€ë¡œ ìš°í•˜ë‹¨ ì¢Œí‘œë¥¼ êµ¬í•˜ê¸° ìœ„í•´ ì¢Œìƒë‹¨ ì¢Œí‘œì— ê°ê°ì„ ë”í•¨.
    right = left + rect[2]
    bottom = top + rect[3]

    img_rgb_copy = cv2.rectangle(img_rgb_copy, (left, top), (right, bottom), color=green_rgb, thickness=2)

plt.figure(figsize=(8, 8))
plt.imshow(img_rgb_copy)
plt.show()
```


![](https://i.imgur.com/OAnp0KW.png)



#### bounding boxì˜ í¬ê¸°ê°€ í° í›„ë³´ë§Œ ì¶”ì¶œ


```python
cand_rects = [cand['rect'] for cand in regions if cand['size'] > 10000]

green_rgb = (125, 255, 51)
img_rgb_copy = img_rgb.copy()
for rect in cand_rects:

    left = rect[0]
    top = rect[1]
    # rect[2], rect[3]ì€ ë„ˆë¹„ì™€ ë†’ì´ì´ë¯€ë¡œ ìš°í•˜ë‹¨ ì¢Œí‘œë¥¼ êµ¬í•˜ê¸° ìœ„í•´ ì¢Œìƒë‹¨ ì¢Œí‘œì— ê°ê°ì„ ë”í•¨.
    right = left + rect[2]
    bottom = top + rect[3]

    img_rgb_copy = cv2.rectangle(img_rgb_copy, (left, top), (right, bottom), color=green_rgb, thickness=2)

plt.figure(figsize=(8, 8))
plt.imshow(img_rgb_copy)
plt.show()
```


    
![](https://i.imgur.com/KfMUAXK.png)

    


### IOU êµ¬í•˜ê¸°

#### ì…ë ¥ì¸ìë¡œ í›„ë³´ ë°•ìŠ¤ì™€ ì‹¤ì œ ë°•ìŠ¤ë¥¼ ë°›ì•„ì„œ IOUë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ ìƒì„±


```python
import numpy as np

def compute_iou(cand_box, gt_box):

    # Calculate intersection areas
    x1 = np.maximum(cand_box[0], gt_box[0])
    y1 = np.maximum(cand_box[1], gt_box[1])
    x2 = np.minimum(cand_box[2], gt_box[2])
    y2 = np.minimum(cand_box[3], gt_box[3])

    intersection = np.maximum(x2 - x1, 0) * np.maximum(y2 - y1, 0)

    cand_box_area = (cand_box[2] - cand_box[0]) * (cand_box[3] - cand_box[1])
    gt_box_area = (gt_box[2] - gt_box[0]) * (gt_box[3] - gt_box[1])
    union = cand_box_area + gt_box_area - intersection

    iou = intersection / union
    return iou
```


```python
import cv2
import matplotlib.pyplot as plt
%matplotlib inline

# ì‹¤ì œ box(Ground Truth)ì˜ ì¢Œí‘œë¥¼ ì•„ë˜ì™€ ê°™ë‹¤ê³  ê°€ì •.
gt_box = [60, 15, 320, 420]


img = cv2.imread('./data/audrey01.jpg')
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

red = (255, 0 , 0)
img_rgb = cv2.rectangle(img_rgb, (gt_box[0], gt_box[1]), (gt_box[2], gt_box[3]), color=red, thickness=2)

plt.figure(figsize=(8, 8))
plt.imshow(img_rgb)
plt.show()
```


    
![](https://i.imgur.com/EIccVWR.png)

    



```python
import selectivesearch

#selectivesearch.selective_search()ëŠ” ì´ë¯¸ì§€ì˜ Region Proposalì •ë³´ë¥¼ ë°˜í™˜
img = cv2.imread('./data/audrey01.jpg')
img_rgb2 = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
_, regions = selectivesearch.selective_search(img_rgb2, scale=100, min_size=2000)

print(type(regions), len(regions))
```

    <class 'list'> 41



```python
[cand['rect'] for cand in regions]
```




    [(0, 0, 107, 167),
     (15, 0, 129, 110),
     (121, 0, 253, 133),
     (134, 17, 73, 62),
     (166, 23, 87, 176),
     (136, 53, 88, 121),
     (232, 79, 117, 147),
     (50, 91, 133, 123),
     (305, 97, 69, 283),
     (0, 161, 70, 46),
     (72, 171, 252, 222),
     (0, 181, 118, 85),
     (106, 210, 89, 101),
     (302, 228, 66, 96),
     (0, 253, 92, 134),
     (153, 270, 173, 179),
     (0, 305, 47, 139),
     (104, 312, 80, 71),
     (84, 360, 91, 67),
     (0, 362, 171, 87),
     (297, 364, 77, 85),
     (0, 91, 183, 175),
     (136, 23, 117, 176),
     (72, 171, 254, 278),
     (134, 17, 119, 182),
     (302, 97, 72, 283),
     (121, 0, 253, 226),
     (0, 91, 183, 175),
     (0, 0, 144, 167),
     (0, 0, 253, 199),
     (0, 253, 92, 191),
     (0, 91, 183, 353),
     (0, 171, 326, 278),
     (0, 97, 374, 352),
     (84, 312, 100, 115),
     (0, 91, 184, 353),
     (0, 91, 195, 353),
     (0, 0, 374, 444),
     (0, 0, 374, 449),
     (0, 0, 374, 449),
     (0, 0, 374, 449)]




```python
cand_rects = [cand['rect'] for cand in regions]
for index, cand_box in enumerate(cand_rects):
    cand_box = list(cand_box)
    cand_box[2] += cand_box[0]
    cand_box[3] += cand_box[1]

    iou = compute_iou(cand_box, gt_box)
    print('index:', index, "iou:", iou)
```

    index: 0 iou: 0.06157293686705451
    index: 1 iou: 0.07156308851224105
    index: 2 iou: 0.2033654637255666
    index: 3 iou: 0.04298195631528965
    index: 4 iou: 0.14541310541310543
    index: 5 iou: 0.10112060778727446
    index: 6 iou: 0.11806905615946989
    index: 7 iou: 0.1420163334272036
    index: 8 iou: 0.035204259342190375
    index: 9 iou: 0.004256894317971497
    index: 10 iou: 0.5184766640298338
    index: 11 iou: 0.04465579710144928
    index: 12 iou: 0.0853656220322887
    index: 13 iou: 0.015722240419259743
    index: 14 iou: 0.037833068643021
    index: 15 iou: 0.22523535071077264
    index: 16 iou: 0.0
    index: 17 iou: 0.053941120607787274
    index: 18 iou: 0.05154006626579948
    index: 19 iou: 0.05660327592118798
    index: 20 iou: 0.01165009904393209
    index: 21 iou: 0.18588082901554404
    index: 22 iou: 0.19555555555555557
    index: 23 iou: 0.5409250175192712
    index: 24 iou: 0.205679012345679
    index: 25 iou: 0.042245111210628454
    index: 26 iou: 0.34848824374009246
    index: 27 iou: 0.18588082901554404
    index: 28 iou: 0.10952135872362326
    index: 29 iou: 0.29560078245307364
    index: 30 iou: 0.045470015655843715
    index: 31 iou: 0.3126506582607083
    index: 32 iou: 0.4934902582553282
    index: 33 iou: 0.5490037131949166
    index: 34 iou: 0.1018867924528302
    index: 35 iou: 0.31513409961685823
    index: 36 iou: 0.3423913043478261
    index: 37 iou: 0.6341234282410753
    index: 38 iou: 0.6270619201314865
    index: 39 iou: 0.6270619201314865
    index: 40 iou: 0.6270619201314865



```python
cand_rects = [cand['rect'] for cand in regions if cand['size'] > 5000]
cand_rects.sort()
cand_rects
```




    [(0, 0, 107, 167),
     (0, 0, 144, 167),
     (0, 0, 253, 199),
     (0, 0, 374, 444),
     (0, 0, 374, 449),
     (0, 0, 374, 449),
     (0, 0, 374, 449),
     (0, 91, 183, 175),
     (0, 91, 183, 175),
     (0, 91, 183, 353),
     (0, 91, 184, 353),
     (0, 91, 195, 353),
     (0, 97, 374, 352),
     (0, 171, 326, 278),
     (0, 181, 118, 85),
     (0, 253, 92, 134),
     (0, 253, 92, 191),
     (0, 362, 171, 87),
     (15, 0, 129, 110),
     (50, 91, 133, 123),
     (72, 171, 252, 222),
     (72, 171, 254, 278),
     (84, 312, 100, 115),
     (121, 0, 253, 133),
     (121, 0, 253, 226),
     (134, 17, 119, 182),
     (136, 23, 117, 176),
     (153, 270, 173, 179),
     (166, 23, 87, 176),
     (232, 79, 117, 147),
     (297, 364, 77, 85),
     (302, 97, 72, 283),
     (305, 97, 69, 283)]




```python
img = cv2.imread('./data/audrey01.jpg')
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
print('img shape:', img.shape)

green_rgb = (125, 255, 51)
cand_rects = [cand['rect'] for cand in regions if cand['size'] > 3000]
gt_box = [60, 15, 320, 420]
img_rgb = cv2.rectangle(img_rgb, (gt_box[0], gt_box[1]), (gt_box[2], gt_box[3]), color=red, thickness=2)

for index, cand_box in enumerate(cand_rects):

    cand_box = list(cand_box)
    cand_box[2] += cand_box[0]
    cand_box[3] += cand_box[1]

    iou = compute_iou(cand_box, gt_box)

    if iou > 0.5:
        print('index:', index, "iou:", iou, 'rectangle:',(cand_box[0], cand_box[1], cand_box[2], cand_box[3]) )
        cv2.rectangle(img_rgb, (cand_box[0], cand_box[1]), (cand_box[2], cand_box[3]), color=green_rgb, thickness=1)
        text = "{}: {:.2f}".format(index, iou)
        cv2.putText(img_rgb, text, (cand_box[0]+ 100, cand_box[1]+10), cv2.FONT_HERSHEY_SIMPLEX, 0.4, color=green_rgb, thickness=1)

plt.figure(figsize=(12, 12))
plt.imshow(img_rgb)
plt.show()

```

    img shape: (450, 375, 3)
    index: 8 iou: 0.5184766640298338 rectangle: (72, 171, 324, 393)
    index: 18 iou: 0.5409250175192712 rectangle: (72, 171, 326, 449)
    index: 28 iou: 0.5490037131949166 rectangle: (0, 97, 374, 449)
    index: 32 iou: 0.6341234282410753 rectangle: (0, 0, 374, 444)
    index: 33 iou: 0.6270619201314865 rectangle: (0, 0, 374, 449)
    index: 34 iou: 0.6270619201314865 rectangle: (0, 0, 374, 449)
    index: 35 iou: 0.6270619201314865 rectangle: (0, 0, 374, 449)



    
![](https://i.imgur.com/GDfDks9.png)

    
### R-CNN, Fast R-CNN, Faster R-CNN ë¹„êµ

1. **R-CNN (Region-based CNN)**    
- ì²« ë²ˆì§¸ ë‹¨ê³„ì—ì„œ Selective Searchë¥¼ ì‚¬ìš©í•˜ì—¬ ì ì¬ì ì¸ ê°ì²´ ì˜ì—­ì„ ì‹ë³„
- ê° ì˜ì—­ì— ëŒ€í•´ ë³„ë„ë¡œ CNNì„ í†µí•´ íŠ¹ì§•ì„ ì¶”ì¶œí•˜ê³ , ì´í›„ SVMì„ ì‚¬ìš©í•˜ì—¬ ê°ì²´ë¥¼ ë¶„ë¥˜
- ê° ì˜ì—­ ì œì•ˆì— ëŒ€í•´ ë³„ë„ì˜ íŠ¹ì§• ì¶”ì¶œì´ í•„ìš”í•˜ë¯€ë¡œ ì†ë„ê°€ ëŠë¦¬ë‹¤
- í›ˆë ¨ ê³¼ì •ì´ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë‚˜ë‰˜ì–´ ìˆì–´ ì‹œê°„ê³¼ ìì›ì´ ë§ì´ í•„ìš”

2. **Fast R-CNN**
- ì „ì²´ ì´ë¯¸ì§€ì— ëŒ€í•´ ë‹¨ í•œ ë²ˆì˜ íŠ¹ì§• ì¶”ì¶œì„ ìˆ˜í–‰í•˜ê³ , RoI Pooling Layerë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ì˜ì—­ ì œì•ˆì— ëŒ€í•œ íŠ¹ì§•ì„ ì¶”ì¶œ
- ë” ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„ë¥¼ ì œê³µí•˜ë©°, íŠ¹ì§• ì¶”ì¶œ ê³¼ì •ì˜ ì¤‘ë³µì„ ì¤„ì¸ë‹¤
- í•˜ë‚˜ì˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ ê°ì²´ ë¶„ë¥˜ì™€ ê²½ê³„ ìƒì íšŒê·€ë¥¼ ë™ì‹œì— ìˆ˜í–‰
- Selective Searchë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì—­ ì œì•ˆì„ ìƒì„±í•˜ë¯€ë¡œ ì—¬ì „íˆ ì¼ë¶€ ì†ë„ ì œì•½ ì¡´ì¬

3. **Faster R-CNN**    
- Fast R-CNNì˜ ê¸°ë³¸ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ, Selective Search ëŒ€ì‹  Region Proposal Network(RPN)ì„ ë„ì…í•˜ì—¬ ì˜ì—­ ì œì•ˆì„ ìë™í™”
- RPNì€ ê°ì²´ì˜ ìœ„ì¹˜ì™€ í¬ê¸°ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ì˜ì—­ ì œì•ˆì„ ë” ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ìƒì„±
- ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ í•˜ë‚˜ì˜ ë„¤íŠ¸ì›Œí¬ë¡œ í†µí•©ë˜ì–´ í›ˆë ¨ê³¼ ì¶”ë¡ ì´ ë”ìš± íš¨ìœ¨ì 
- ê°ì²´ íƒì§€ ì†ë„ì™€ ì •í™•ë„ ëª¨ë‘ì—ì„œ í¬ê²Œ í–¥ìƒëœ ì„±ëŠ¥ì„ ì œê³µ



> selective searchê°€ ê¶ê¸ˆí•˜ë‹¤ë©´ https://github.com/AlpacaTechJP/selectivesearch/blob/develop/selectivesearch/selectivesearch.py 


